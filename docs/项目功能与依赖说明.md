# 项目功能与依赖说明

## 系统概览
- 运行管理系统，覆盖用户与角色权限、组织架构、设备保养、故障维修、安全/卫生检查、岗位/临时任务、消息通知、数据报表等场景。
- 权限模型：基准角色 + 菜单/模块权限自动勾选，支持用户级增补/收回；菜单/模块按功能子页精细拆分。
- 报表模块：设备保养统计、设备故障统计、全年趋势图，支持筛选与 Excel 导出。

## 技术栈与依赖
- 前端：Vue 3 + Vite + Element Plus + Pinia + Axios + ECharts。
- 后端：Node.js 18 + Koa + Sequelize，JWT 认证，MySQL 数据库。
- PLC 微服务：Python Flask（按环境变量连接同一 MySQL）。
- 部署：Docker Compose（服务：mysql、backend、frontend、plc-service），统一时区 Asia/Shanghai。

## 运行与环境
- 推荐直接使用 `docker-compose up -d --build` 启动；开发模式可叠加 `docker-compose.dev.yml`。
- 如本地跑服务需准备：Node.js ≥18、npm/pnpm、Python 3.11（仅 PLC）、MySQL 8.0，数据库连接配置见 `docker-compose.yml` 环境变量。
- 初始化与迁移：
  - MySQL 初始化脚本：`database/init.sql`。
  - 权限扩展脚本：`database/migration_user_permissions.sql`（扩展 permissions 枚举并创建 user_permissions 表）。
  - 后端启动会自动确保权限与角色权限写入（ensurePermissions / ensureRolePermissions）。

## 目录提示
- 前端代码：`frontend/src`（视图、组件、API 封装、Pinia store）。
- 后端代码：`backend/src`（controllers、services、models、routes、middlewares、config）。
- PLC 微服务：`plc-service/`。
- 脚本：`scripts/`（数据库备份、镜像加速配置等）。

## 关键特性
- 角色驱动的权限勾选：选择基准角色即加载默认菜单/模块权限，可在用户层面增/减。
- 报表支持：筛选日期、场站、设备，查看设备分布、状态分布、周期完成率、全年趋势，并导出 Excel。
- 可靠日志与退出：后端提供免认证退出接口，避免登出报 401。
